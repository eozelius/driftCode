<% provide(:title, @user.name) %>

<h3 class="page-title"><%= @user.name %></h3>
<div class="map-container">
	<% if @user.map.nil? %>
		<div class="starter-globe">
			<%= image_tag('globe_' + rand(4).to_s + '.jpg') %>
		</div>

		<div class="start-journey-container">
			<%= link_to new_user_driftmap_path(@user) do %>
				<button class="normal start-journey"><p>start journey</p></button>
			<% end %>
		</div>



	<% else %>
		<div id="profile-map"></div>

		<script type="text/javascript">
			var x = 40.735;
			var y = -73.890;
			var map;

			if(navigator.geolocation){
				navigator.geolocation.getCurrentPosition(function(pos){
					x = pos.coords.latitude.toFixed(3);
					y = pos.coords.longitude.toFixed(3);
					map = L.map('profile-map').setView([x, y], 14);
					// TODO make this API key a Server environment variable
					L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', 
						{
				    	attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
				    	maxZoom: 18,
				    	id: 'eozelius77.j4hekake',
				    	accessToken: 'pk.eyJ1IjoiZW96ZWxpdXM3NyIsImEiOiJkQmhDSl8wIn0.MzOmrtAL3uTNmVfLmEZ57g'
						}).addTo(map);

					L.marker([x, y]).addTo(map);
				});
			} else {
				map = initMap(x, y, 12, false);
			}
	</script>
	<% end %>
</div><!-- End Map -->

<div id="pro-parts-container">
	<div class="pro-part profile-photos col-lg-7 col-md-7 col-sm-12 col-12">
		<h4 class="page-title" style="border:none;">blibs</h4>
		<% if @user.posts.count >= 1 %>
			<%= render 'posts/posts' %>
		<% else%>
			<p style="text-align:center"><%= @user.name %> hasn't been anywhere yet.</p>
		<% end %>
	</div><!-- end where I've been -->

	<div class="pro-part profile">
		<% if user_is_home(@user) %>
			<h4 class="page-title" style="border:none;">new blib</h4>
			<div class="new-blib-container">
				<%= render 'posts/form' %>
			</div>
		<% end %><!-- end create blib -->

		<h4 class="page-title" style="border:none;"><%= @user.name %></h4>
		<div class="profile-details-container">
			<div class="profile-details">
				<%= image_tag @user.profile_pic, :class => 'pp' if @user.profile_pic %>
				<div class="user-info">
					<p><%= @user.name %></p>
					
					<% if @user.from %>
						<p class="user-from">from: </p>
						<p><%= @user.from %></p>
					<% end %>			

					<% if @user.gps %>
						<p class="user-gps">gps coordinates: </p>
						<p><%= @user.gps %></p>
					<% end %>
					
					<% if user_is_home(@user) || admin_user %>
						<p><%= @user.email %></p>
						<p><a class="edit-user-anchor">edit</a><a> | </a><%= link_to 'delete', @user, method: :delete, data: { confirm: "Are you sure?" } %></p>
					<% end %>
				</div><div class="clear-fix"></div>

				<% if user_is_home(@user) || admin_user %>
					<div class="alter-user-container" style="display:none;">
						<%= form_for @user, html: { multipart: true } do |f| %>
							<p>
								<%= f.label 'profile picture' %>
								<%= f.file_field :profile_pic, accept: 'image/jpeg, image/gif, image/png, image/jpg' %>
							</p>
							<p>
								<%= f.label :name %>
								<%= f.text_field :name %>
							</p>

							<p>
								<%= f.label :email %>
								<%= f.text_field :email %>
							</p>							

							<p>
								<%= f.label :from, 'Where are you from?' %>
								<%= f.text_field :from %>
							</p>

							<p>
								<%= f.label :gps, 'Where are you currently?' %>
								<%= f.text_field :gps %>
							</p>
						
							<p>
								<button type="submit" name="commit" value="Create Post" class="normal" style="float:right">done</button>
								<span class="cancel-edit-user normal" style="float:right">cancel</span>
							</p>
						<% end %>
					</div>
				<% end %>
			</div>
		</div><!-- end profile info -->
	</div>
</div>	

<script type="text/javascript">
	$(document).ready(function(){
		// edit post
		$('a.edit-anchor').bind('click', function(){
			console.log("slideDown");
			$('.alter-post-container').slideDown();
		});

		// cancel edit post
		$('.cancel-edit-post').on('click', function(){
			$('.alter-post-container').slideUp();
		});

		// edit profile info
		$('.edit-user-anchor').on('click', function(){
			$('.alter-user-container').slideDown();
			$('.profile-details-container').addClass('form-open');
		});

		// cancel edit user
		$('.cancel-edit-user').on('click', function(){
			$('.alter-user-container').slideUp();
			$('.profile-details-container').removeClass('form-open');
		});
	});
</script>