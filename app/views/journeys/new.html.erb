<div id="journey" class="new-journey">
	<div class="container">
		<h4 class="waypoint-title" style="color:#C2D9EB;font-size:2.5em;margin-bottom:35px;width: -moz-fit-content;">Create New Journey</h4>

		<div id="driftmap-timeline-container" class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
			<%= form_for @route, html: { multipart: true } do |f| %>
				<div class="journey-info">
					<!-- Journey Cover Photo -->
					<h4 class="waypoint-title">cover photo</h4>
					<%= f.file_field :coverphoto, { style: 'margin-left:3%;' } %>

					<!-- Journey metadata -->
					<h4 class="waypoint-title">title</h4>
					<%= f.text_field :title, { style: 'margin-left:3%;' } %>

					<h4 class="waypoint-title">description</h4>
					<%= f.text_area :description %>
				</div>
		</div>

			<div id="driftmap-timeline-container" class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
				<%= link_to user_path(current_user) do %>
					<span class="normal cancel">cancel</span>
				<% end %>

				<button name="commit" class="normal commit" type="submit" style="margin: 35px 0">save</button>
			</div>
		<% end %>
	</div>
</div>

<script type="text/javascript">
	$(function(){
		// init date-picker-calender
		$('#datetimepicker1').datetimepicker({format: 'DD/MM/YYYY'});

		var photo_index = 0;

		// create first stop manually
		$('.create-first-stop').on('click', function(){
			$('.journey-info, .first-stop-info, .existing-blips, .journey-stops').toggleClass('hidden');
			$('form').append('<input type="hidden" name="new_blip" value="true">');
		});

		// add photos to blip
		$(document).on('click', '.add-photo', function(){
			$(this).data('photo-index', ++photo_index)
			var index = $(this).data('photo-index')
			var new_img = '<input class="blip-image" name="photo['+ index +']" accept="image/jpeg, image/gif, image/png, image/jpg" type="file" data-image="'+ index +'" style="margin: 6% 6% 5% 3%; width:100%;">';
			$('.add-photo').last().after(new_img);
		});

		// set location of blip
		/*window.map.on('click', function(e){
			window.map.off('click');
			setLatLng(e.latlng.lat, e.latlng.lng);

			var m = L.marker([e.latlng.lat, e.latlng.lng]).addTo(window.map)
			m.dragging.enable();
			m.on('dragend', function(e){
				setLatLng(e.target.getLatLng().lat, e.target.getLatLng().lng)
			});
		});*/

		// submit form
		$('.commit').on('click', function(){
			var date = $('#blip-date').val();
			var mm = 	 date.slice(0, 2)
			var dd = 	 date.slice(3, 5)
			var yyyy = date.slice(6, 10);
			$('#blip_date').val(yyyy + mm + dd);

			if( $('.leaflet-marker-icon').length ){
				$('form').submit();
			} else {
				alert('A location must be set, click anywhere on the map to set your blip.');
			}

		});

		function setLatLng(lat, lng) {
			$('#blip_x').val(lat);
			$('#blip_y').val(lng);			
		}
	});
</script>