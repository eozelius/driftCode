<script type="text/javascript">
	var driftmap = {
		init_x: '<%= @post.init_x %>',
		init_y: '<%= @post.init_y %>',
		init_zoom: '<%= @post.init_zoom %>',
	}

	var blips = [];

	<% if @post.blips.any? %>	
		<% @post.blips.each do |blip| %>

			var blipImages = [];
			<% blip.blip_images.each do |blip_image| %>
				blipImages.push('<%= image_tag(blip_image.image).html_safe %>');
			<% end %>

			blips.push({
				id: 		"<%= blip.id %>",
				x: 			"<%= blip.x %>",
				y: 			"<%= blip.y %>",
				title: 	"<%= blip.title.to_json %>",
				body: 	"<%= blip.body.to_json %>",
				images: blipImages
			})

		<% end %>
	<% end %>

	var routes = [];

	<% if @post.routes.any? %>
		<% @post.routes.each do |route| %>

			var routePoints = [];
			<% route.route_points.each do |route_point| %>
				routePoints.push({
					x: '<%= route_point.x %>',
					y: '<%= route_point.y %>',
					order: '<%= route_point.order %>'
				});
			<% end %>

			routes.push({
				description: "<%= route.description.to_json %>",
				routePoints: routePoints
			});
		<% end %>
	<% end %>

	init_map('map', driftmap, blips, routes)
</script>