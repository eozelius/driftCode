<% if !logged_in? %>
  <div class="readme-container">
    <h4>Welcome to driftMap</h4>
    <p>driftMap is a backpacking and travelling platform that allows you to share a map of your journeys, adventures and wild experiences. </p>
    <%= link_to signup_path do %>
    	<button class="normal">Sign up</button>
    <% end %>

    <%= link_to login_path do %>
    	<button class="normal">Log in</button>
    <% end %>
  </div>
<% end %>

<div class="container">
  <div id="dm-content-container" class="col-lg-8 col-md-8 col-sm-12 col-xs-12">

    <% blips = User.first.post.blips %>

    <% blips.each_with_index do |blip, index| %>
      <div class="blip-content <%= 'hidden' if index != 0 %>" data-blip="<%= index %>">
        <% if blip.blip_images.any? %>
          <div id="images-carousel" class="carousel slide" data-ride="carousel">
            <!-- Indicators -->
            <ol class="carousel-indicators">
              <% blip.blip_images.count.times do |b| %>
                <li data-target="#images-carousel" data-slide-to="<%= b %>" class="active"></li>
              <% end %>
            </ol>

            <!-- Blip Photos -->
            <div class="carousel-inner" role="listbox">
              <% blip.blip_images.each_with_index do |image, i| %>
                <div class="item <%= 'active' if i == 0 %>">
                  <%= image_tag image.image %>
                </div>
              <% end %>
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
              <i class="fa fa-angle-left fa-3x" aria-hidden="true"></i>
              <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
              <i class="fa fa-angle-right fa-3x" aria-hidden="true"></i>
              <span class="sr-only">Next</span>
            </a>
          </div><!-- end carousel -->
        <% end %>

        <div class="blip-info" data-blip="<%= blip.id %>">
          <p class="blip-body">
            <%= blip.body %>
          </p>
        </div>
      </div>
    <% end %>
  </div>

  <div id="dm-legend" class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
    <div class="map-container">
      <div id='map'></div>
      <%= render 'driftmap/init_driftmap' %>
    </div>

    <div class="view-wizard-container">
      <!-- blips -->
      <div class="markers-container wizard-step">
        <div class="wizard-markers">
          <ul>
            <% @post.blips.each do |blip| %>
              <li class="blip">
                <p class="blip-title" data-blip="<%= blip.id %>" data-initx="<%= blip.x %>" data-inity="<%= blip.y %>">
                  <%= blip.title %>
                </p>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>    
  </div>
</div>

<script type="text/javascript">
  // reveal blip info
  $('.blip-title').on('click', function(){
    var active = $(this).hasClass('active');
    var blip_index = $(this).data('blip');
    $('.blip-content').addClass('hidden');
    $('.blip-content[data-blip="'+ blip_index +'"]').removeClass("hidden");

    if(active){
      $(this).removeClass('active');
    } else {
      $('.blip-info[data-blip="'+ blip_index +'"]').slideDown(700);
      $(this).addClass('active');
      var init_x = $(this).data('initx');
      var init_y = $(this).data('inity');
      window.map.setView([init_x, init_y]).setZoom(9);
    }
  });


</script>