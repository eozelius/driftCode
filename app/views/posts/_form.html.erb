<% if @post.errors.any? %>
  <div class="errors">
    <p class="title">whoops</p>
    <ul class="errors-list">
      <% @post.errors.full_messages.each do |msg| %>
        <li><p><%= msg %></p></li>
      <% end %>
    </ul>
  </div>  
<% end %>

<h3 class="page-title">driftMap</h3>

<div class="step-3-slide" id="now-map-container">
  <!-- driftmap -->
  <div class="col-lg-7 col-md-7 col-sm-12 col-xs-12">
    <div id="post-map"></div>
  </div>

  <script type="text/javascript">
    var init_x = 40.735;
    var init_y = -73.890;
    var zoom   = 13;
    var map;

    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(function(pos){
        x = pos.coords.latitude.toFixed(3);
        y = pos.coords.longitude.toFixed(3);
        map = L.map('post-map').setView([x, y], 12);
        // TODO make this API key a Server environment variable
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', 
          {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            id: 'eozelius77.j4hekake',
            accessToken: 'pk.eyJ1IjoiZW96ZWxpdXM3NyIsImEiOiJkQmhDSl8wIn0.MzOmrtAL3uTNmVfLmEZ57g'
          }).addTo(map);
      });
    } else {
      map = initMap(x, y, 12, false);
    }
  </script>

  <div class="drift-map-instructions col-lg-5 col-md-5 col-sm-12 col-xs-12">
    <%= form_for @post, html: { multipart: true } do |f| %>
      <!-- Step 1 Title -->
      <p class="instructions-title">title</p>
      <div class="action-title details-open" >
        <%= f.text_field :title %>
      </div>

      <!-- Step 2 description -->
      <div data-action="body" class="wizard-step" >
        <p class="instructions-title">sum up your driftMap in 10 words</p>
        <div class="action-body">
          <%= f.text_area :body, id: 'driftmap-body' %>
        </div>
      </div>

      <!-- Step 3 Init -->
      <div data-action="init" class="wizard-step" >
        <p class="instructions-title">drag and zoom your map to the location and zoom level you would like</p>
        <%= f.hidden_field :init_x %>
        <%= f.hidden_field :init_y %>
        <%= f.hidden_field :init_zoom %>
      </div>

      <div class="action-footer">
        <span class="save-wizard normal">save</span>
      </div>
    <% end %>


    <% if false %>
    <div class="tabs-container">
      <ul class="instructions-container ">
        <li data-action="title" class="wizard-step open"><p>title</p></li>
        <li data-action="body" class="wizard-step"><p>description</p></li>
        <li data-action="init" class="wizard-step"><p>initialize</p></li>
        <li data-action="markers" class="wizard-step"><p>radar</p></li>
        <li data-action="routes" class="wizard-step"><p>routes</p></li>
      </ul>
    </div>

    <div class="action-container">
      <%= form_for @post, html: { multipart: true } do |f| %>
        <!-- Step 1 Title -->
        <div data-action="title" class="wizard-step open-action">
          <p class="instructions-title">give your driftMap a catchy name</p>
          <div class="action-title details-open" >
            <%= f.text_field :title %>
          </div>
        </div>

        <!-- Step 2 description -->
        <div data-action="body" class="wizard-step" >
          <p class="instructions-title">sum up your driftMap in 10 words</p>
          <div class="action-body">
            <%= f.text_area :body, id: 'driftmap-body' %>
          </div>
        </div>

        <!-- Step 3 Init -->
        <div data-action="init" class="wizard-step" >
          <p class="instructions-title">drag and zoom your map to the location and zoom level you would like</p>
          <%= f.hidden_field :init_x %>
          <%= f.hidden_field :init_y %>
          <%= f.hidden_field :init_zoom %>
        </div>

        <!-- Step 4 Markers -->
        <div data-action="markers" class="wizard-step" >
          <p class="wizard-step-title">radar</p>
          <div class="action-markers wizard-action">
            <p class="instructions-title">your radar is your all of your adventures, backpacking trips, people you met, 'a zip-lining accident', whatever you want.</p>

            <button class="normal">new blib</button>
          </div>
        </div>

        <!-- Create-Step 5 Routes -->
        <div data-action="routes" class="wizard-step">
          <p class="wizard-step-title">routes</p>
          <div class="action-routes">
            <p class="instructions-title">plane, hitch-hiking, boat, train-hopping</p>
            <button class="normal">new route</button>
          </div>
        </div>

        <div class="action-footer">
          <button class="save-wizard normal">save</button>
        </div>
      <% end %>  
    </div>
    <% end %>
  </div>
</div>

<script type="text/javascript">
  $('#post_picture').on('change', function() {
    var size_in_megabytes = this.files[0].size/1024/1024;
    if (size_in_megabytes > 3){
      alert('Maximum file size is 3MB. Please choose a smaller file.');
      return false;
    }
  });
</script>